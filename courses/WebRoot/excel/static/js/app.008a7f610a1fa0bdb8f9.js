webpackJsonp([1],{0:function(e,t){},1:function(e,t){},2:function(e,t){},"HB+n":function(e,t){},NHnr:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("7+uW"),l=a("J/zc"),i=a.n(l),o=a("9RZ8"),n=a.n(o),h=a("mvHQ"),r=a.n(h),c=a("uXZL"),u=a.n(c),p={name:"Courses",data:function(){return{labelPosition:"top",sheets:[],sheet:"",opers:[],oper:"0",students:[],stu:"",extras:[],extra:"",teachers:[],tch:"",dateTypes:[],dtype:"1",dates:[],day1:"",day2:"",courTypes:[],cType:"",file:{upUrl:"http://127.0.0.1:8080/courses/ie/getFileInfo",delUrl:"http://127.0.0.1:8080/courses/ie/delFile",exts:"xls,xlsx",size:"5MB"},filename:"",ths:[],filedata:{},tableData:[],showData:[],currentPage:1,total:20,pageSize:13,pageSizes:[1,5,13,26],dataLoading:!1,spanArrs:{},activeTab:"upload",downdata:{name:"",formats:[],format:"",sheet:""}}},mounted:function(){this.init()},methods:{init:function(){this.opers.push({label:"学生",value:"0"}),this.opers.push({label:"教师",value:"1"}),this.opers.push({label:"未归类",value:"2"}),this.dateTypes.push({label:"指定日期",value:"0"}),this.dateTypes.push({label:"指定时间段",value:"1"}),this.downdata.formats.push({label:"json",value:"0"}),this.downdata.formats.push({label:"xlsx",value:"1"})},uploadDone:function(e){var t=this;this.clear();var a=e[0];this.filedata=a,console.log(a),this.filename=a.filename;var s=a.snames,l=a.sheets;s.forEach(function(e,a){t.sheets.push({value:e,label:e})}),this.sheet=this.sheets[0].value;var i=l[this.sheet].info;this.teachers=i.teachers,this.students=i.students,this.extras=i.extras,this.courTypes=i.courTypes,this.dates=i.dates,this.day1=this.dates[0].value,this.day2=this.dates[this.dates.length-1].value,this.dataLoading=!0,this.ths=i.ths;var o=l[this.sheet].list;this.tableData=o,this.showData=o.slice((this.currentPage-1)*this.pageSize,this.currentPage*this.pageSize),this.pageSizes.push(this.tableData.length),this.showData.length>0&&this.getSpanArrs(),this.dataLoading=!1,this.activeTab="preview"},getSpanArrs:function(){var e=[];for(var t in this.showData[0])"idx"!=t&&e.push(t);for(var a=0;a<e.length;a++){t=e[a];var s=[],l=0,i="";this.showData.forEach(function(e,a){0==a?(i=e[t],s.push(1)):i==e[t]?(s.push(0),s[l]=s[l]+1):(s.push(1),l=a,i=e[t])}),this.spanArrs[t]=s}},colSpanMethod:function(e){e.row,e.column;var t=e.rowIndex,a="col"+e.columnIndex,s=this.spanArrs[a];return 1===s[t]?{rowspan:1,colspan:1}:s[t]>1?{rowspan:s[t],colspan:1}:0===s[t]?{rowspan:0,colspan:0}:void 0},sheetChg:function(e){this.reset();var t=this.filedata.sheets[e].info;this.teachers=t.teachers,this.students=t.students,this.extras=t.extras,this.courTypes=t.courTypes,this.dates=t.dates,this.day1=this.dates[0].value,this.day2=this.dates[this.dates.length-1].value,this.ths=t.ths;var a=this.filedata.sheets[e].list;this.tableData=a,this.currentPage=1,this.pageSize=13,this.pageSizes=[1,5,13,26],this.pageSizes.push(this.tableData.length),this.refreshData()},clear:function(){this.reset(),this.sheets=[],this.sheet="",this.students=[],this.teachers=[],this.dates=[],this.courTypes=[],this.extras=[],this.filename="",this.pageSizes=[1,5,13,26],this.pageSize=13,this.currentPage=1},check:function(){var e=!0;return""==this.day1&&"2"!=this.oper?(this.showError("请指定日期"),e=!1):"1"==this.dtype&&""==this.day2&&"2"!=this.oper?(this.showError("请指定终止日期"),e=!1):"1"==this.dtype&&(this.day1>this.day2||this.day1==this.day2)&&"2"!=this.oper?(this.showError("指定起始日期必须早于终止日期"),e=!1):e},preview:function(e){if(!this.check())return!1;var t=[];t.push(this.day1),"1"==this.dtype&&t.push(this.day2),this.dataLoading=!0,this.currentPage=1,this.pageSize=13,this.pageSizes=[1,5,13,26],"0"==this.oper?this.showStu(this.stu,t):"2"==this.oper?this.showExt(this.extra):this.showTch(this.tch,t,this.cType),this.dataLoading=!1,e&&(this.activeTab="preview")},showStu:function(e,t){var a=this,s=this.getOrgData(),l=s.info,i=s.list;this.ths=[],this.tableData=[],this.ths.push({value:"col0",label:"学生"}),this.ths.push({value:"col1",label:"日期"}),this.ths.push({value:"col2",label:"时间"}),this.ths.push({value:"col3",label:"教师"});var o=l.ths,n=[];if(1==t.length)o.forEach(function(e,a){e.value=="col"+t[0]&&n.push(e.label)});else{for(var h=[],r=t[0];r<=t[1];r++)h.push("col"+r);o.forEach(function(e,t){h.indexOf(e.value)>-1&&n.push(e.label)})}if(""!=e)i.forEach(function(t,s){for(var l in t)if(t[l]==e){var i={};i.col0=e;var h="";if(o.forEach(function(e,t){e.value==l&&(h=e.label)}),n.indexOf(h)>-1){var r=!1;a.tableData.length>0&&a.tableData.forEach(function(e,a){e.col1==h&&e.col3==t.col0&&(r=!0,e.col2=e.col2+" "+t.col1)}),r||(i.col1=h,i.col2=t.col1,i.col3=t.col0,a.tableData.push(i))}}});else{var c=this.students.map(function(e){return e.value});i.forEach(function(e,t){for(var s in e)if(c.indexOf(e[s])>-1){var l={};l.col0=e[s];var i="";if(o.forEach(function(e,t){e.value==s&&(i=e.label)}),n.indexOf(i)>-1){var h=!1;a.tableData.length>0&&a.tableData.forEach(function(t,a){t.col1==i&&t.col3==e.col0&&t.col0==e[s]&&(h=!0,t.col2=t.col2+" "+e.col1)}),h||(l.col1=i,l.col2=e.col1,l.col3=e.col0,a.tableData.push(l))}}})}this.tableData.sort(function(e,t){return e.col0<t.col0?-1:e.col0>t.col0?1:0}),this.tableData.length>this.pageSizes[this.pageSizes.length-1]&&this.pageSizes.push(this.tableData.length),this.refreshData()},showTch:function(e,t,a){var s=this,l=this.getOrgData(),i=l.info,o=l.list;this.ths=[],this.tableData=[];var n=[];if(1==t.length)console.log(t[0]),console.log(i),n.push("col"+t[0]),i.ths.forEach(function(e,a){"col0"==e.value||"col1"==e.value?s.ths.push(e):e.value=="col"+t[0]&&(e.value="col2",s.ths.push(e))}),console.log(this.ths);else{for(var h=t[0];h<=t[1];h++)n.push("col"+h);var r=2;i.ths.forEach(function(e,t){"col0"==e.value||"col1"==e.value?s.ths.push(e):n.indexOf(e.value)>-1&&(e.value="col"+r,s.ths.push(e),r++)})}o.forEach(function(t,l){var i={};if(""==e||t.col0==e){i.col0=t.col0,i.col1=t.col1;for(var o=0;o<n.length;o++){var h=n[o],r="col"+(o+2);""==a||void 0!=t[h]&&t[h].indexOf(a)>-1?i[r]=t[h]:i[r]=""}s.tableData.push(i)}}),this.tableData.length>this.pageSizes[this.pageSizes.length-1]&&this.pageSizes.push(this.tableData.length),this.refreshData()},showExt:function(e){var t=this,a=this.getOrgData(),s=a.info.ths,l=a.list;if(this.ths=[],this.tableData=[],this.ths.push({value:"col0",label:"未归类对象"}),this.ths.push({value:"col1",label:"日期"}),this.ths.push({value:"col2",label:"时间"}),this.ths.push({value:"col3",label:"教师"}),""!=e)l.forEach(function(a,l){for(var i in a)if(a[i]==e){var o={};o.col0=e;var n="";s.forEach(function(e,t){e.value==i&&(n=e.label)});var h=!1;t.tableData.length>0&&t.tableData.forEach(function(e,t){e.col1==n&&e.col3==a.col0&&(h=!0,e.col2=e.col2+" "+a.col1)}),h||(o.col1=n,o.col2=a.col1,o.col3=a.col0,t.tableData.push(o))}});else{var i=this.extras.map(function(e){return e.value});l.forEach(function(e,a){for(var l in e)if(i.indexOf(e[l])>-1){var o={};o.col0=e[l];var n="";s.forEach(function(e,t){e.value==l&&(n=e.label)});var h=!1;t.tableData.length>0&&t.tableData.forEach(function(t,a){t.col1==n&&t.col0==e[l]&&t.col3==e.col0&&(h=!0,t.col2=t.col2+" "+e.col1)}),h||(o.col1=n,o.col2=e.col1,o.col3=e.col0,t.tableData.push(o))}})}this.tableData.sort(function(e,t){return e.col0<t.col0?-1:e.col0>t.col0?1:0}),this.tableData.length>this.pageSizes[this.pageSizes.length-1]&&this.pageSizes.push(this.tableData.length),this.refreshData()},getOrgData:function(){var e=JSON.parse(r()(this.filedata.sheets));return{info:e[this.sheet].info,list:e[this.sheet].list}},reset:function(){this.oper="1",this.stu="",this.tch="",this.dtype="1",this.day1="",this.day2="",this.cType="",this.extra=""},downCheck:function(){return""==this.downdata.name.trim()?(this.showError("请填写下载文件名"),!1):""==this.downdata.format?(this.showError("请选择文件格式"),!1):""!=this.downdata.sheet||(this.showError("请填写sheet名称"),!1)},download:function(){if(!this.downCheck())return!1;if(this.preview(!1),"0"==this.downdata.format)this.jsonDownload(r()(this.tableData),this.downdata.name+".json");else if("1"==this.downdata.format){var e=[],t=[];for(var a in this.tableData[0])"idx"!=a&&t.push(a);for(var s=0;s<t.length;s++){a=t[s];var l=[],i=0,o="";if(this.tableData.forEach(function(e,t){0==t?(o=e[a],l.push(1)):o==e[a]?(e[a]=null,l.push(0),l[i]=l[i]+1):(l.push(1),i=t,o=e[a])}),l.length>0)for(var n=0;n<l.length;n++){var h=l[n];if(h>1)(v={}).s={r:n+1,c:s},v.e={r:n+h,c:s},e.push(v)}}var c=[];c.push(this.ths.map(function(e){return e.label})),this.tableData.forEach(function(e,t){var a=[];for(var s in e)a.push(e[s]);c.push(a)});var p=u.a.utils.aoa_to_sheet(c);p["!merges"]=e,console.log(p);var d=[];if("1"==this.oper){d=[{wpx:120},{wpx:150}];for(var f=0;f<this.ths.length-2;f++){var v={wpx:100};d.push(v)}}else d.push({wpx:120}),d.push({wpx:100}),d.push({wpx:180}),d.push({wpx:120});p["!cols"]=d;var b=u.a.utils.book_new();u.a.utils.book_append_sheet(b,p,this.downdata.sheet),u.a.writeFile(b,this.downdata.name+".xlsx")}},jsonDownload:function(e,t){var a=document.createElement("a");a.download=t,a.style.display="none";var s=new Blob([e],{type:"text/plain;charset=utf-8"});a.href=URL.createObjectURL(s),document.body.appendChild(a),a.click(),document.body.removeChild(a)},handleClick:function(e,t){"download"==e.name&&(this.setExpName(),this.setSheetName())},setExpName:function(){var e=this;switch(this.downdata.name=this.filename.split(".")[0]+"_"+this.sheet,this.oper){case"0":""==this.stu?this.downdata.name+="_student":this.downdata.name+="_student_"+this.stu;break;case"1":""==this.tch?this.downdata.name+="_teacher":this.downdata.name+="_teacher_"+this.tch;break;case"2":""==this.extra?this.downdata.name+="_extra":this.downdata.name+="_"+this.extra;break;default:this.downdata.name+="_teacher"}""!=this.cType&&(this.downdata.name+="_"+this.cType),"0"==this.dtype?this.dates.forEach(function(t,a){e.day1==t.value&&(e.downdata.name+="_"+t.label)}):this.dates.forEach(function(t,a){e.day1==t.value&&(e.downdata.name+="_"+t.label),e.day2==t.value&&(e.downdata.name+="-"+t.label)})},setSheetName:function(){this.downdata.sheet=this.sheet},handleSizeChange:function(e){this.currentPage=1,this.pageSize=e,this.refreshData()},handleCurrentChange:function(e){this.currentPage=e,this.refreshData()},refreshData:function(){var e=JSON.parse(r()(this.tableData));this.showData=e.slice((this.currentPage-1)*this.pageSize,this.currentPage*this.pageSize),this.getSpanArrs()},showError:function(e){this.$dlg.alert(void 0==e?"访问数据失败，请重试":e,{messageType:"error",language:"cn"})}},watch:{}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("el-container",[a("el-aside",{attrs:{width:"200px"}},[a("el-form",{attrs:{"label-position":e.labelPosition,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"Sheet"}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:e.sheetChg},model:{value:e.sheet,callback:function(t){e.sheet=t},expression:"sheet"}},e._l(e.sheets,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"操作对象"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.oper,callback:function(t){e.oper=t},expression:"oper"}},e._l(e.opers,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),0==e.oper?a("el-form-item",{attrs:{label:"学生姓名"}},[a("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择"},model:{value:e.stu,callback:function(t){e.stu=t},expression:"stu"}},e._l(e.students,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1):e._e(),e._v(" "),1==e.oper?a("el-form-item",{attrs:{label:"教师姓名"}},[a("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择"},model:{value:e.tch,callback:function(t){e.tch=t},expression:"tch"}},e._l(e.teachers,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1):e._e(),e._v(" "),2==e.oper?a("el-form-item",{attrs:{label:"未归类学生"}},[a("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择"},model:{value:e.extra,callback:function(t){e.extra=t},expression:"extra"}},e._l(e.extras,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1):e._e(),e._v(" "),2!=e.oper?a("el-form-item",{attrs:{label:"导出时限"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.dtype,callback:function(t){e.dtype=t},expression:"dtype"}},e._l(e.dateTypes,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),2!=e.oper?a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.day1,callback:function(t){e.day1=t},expression:"day1"}},e._l(e.dates,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1):e._e(),e._v(" "),1==e.dtype?a("span",[e._v("至")]):e._e(),e._v(" "),1==e.dtype&&2!=e.oper?a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.day2,callback:function(t){e.day2=t},expression:"day2"}},e._l(e.dates,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1):e._e()],1):e._e(),e._v(" "),2!=e.oper&&0!=e.oper?a("el-form-item",{attrs:{label:"课程类型"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.cType,callback:function(t){e.cType=t},expression:"cType"}},e._l(e.courTypes,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1):e._e(),e._v(" "),a("div",{attrs:{id:"btns"}},[a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.preview(!0)}}},[e._v("预览")]),e._v(" "),a("el-button",{attrs:{type:"primary",plain:""},on:{click:e.reset}},[e._v("重置")])],1)],1)],1),e._v(" "),a("el-container",[a("el-main",[a("el-tabs",{attrs:{type:"card","tab-position":"right"},on:{"tab-click":e.handleClick},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[a("el-tab-pane",{attrs:{label:"上传",name:"upload"}},[a("div",{staticStyle:{"margin-top":"100px"}},[a("v-uploader",{attrs:{"upload-file-url":e.file.upUrl,"delete-file-url":e.file.delUrl,preview:!1,"file-type-exts":e.file.exts,"upload-file-obj-name":"file","file-size-limit":e.file.size},on:{done:e.uploadDone}}),e._v(" "),""!=e.filename?a("span",[e._v(e._s(e.filename))]):e._e()],1)]),e._v(" "),e.ths.length>0?a("el-tab-pane",{attrs:{label:"预览",name:"preview"}},[e.ths.length>0?a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.dataLoading,expression:"dataLoading"}],attrs:{border:"",data:e.showData,height:"550","span-method":e.colSpanMethod}},[e._l(e.ths,function(e,t){return[a("el-table-column",{key:t,attrs:{prop:e.value,label:e.label,fixed:"",sortable:""}})]})],2):e._e(),e._v(" "),e.tableData.length>=e.pageSize?a("div",{staticClass:"block",staticStyle:{"margin-top":"15px"}},[a("el-pagination",{attrs:{align:"center","current-page":e.currentPage,"page-sizes":e.pageSizes,"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.tableData.length},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1):e._e()],1):e._e(),e._v(" "),e.ths.length>0?a("el-tab-pane",{attrs:{label:"下载",name:"download"}},[a("el-form",{staticClass:"downForm",attrs:{"label-position":"right","label-width":"100px"}},[a("el-form-item",{attrs:{label:"下载文件名"}},[a("el-input",{model:{value:e.downdata.name,callback:function(t){e.$set(e.downdata,"name",t)},expression:"downdata.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"文件格式"}},[a("div",{staticStyle:{"text-align":"left"}},e._l(e.downdata.formats,function(t,s){return a("el-radio",{key:s,attrs:{label:t.value,border:"",size:"large"},model:{value:e.downdata.format,callback:function(t){e.$set(e.downdata,"format",t)},expression:"downdata.format"}},[e._v("\n\t\t\t\t\t\t\t\t\t"+e._s(t.label)+"\n\t\t\t\t\t\t\t\t")])}),1)]),e._v(" "),1==e.downdata.format?a("el-form-item",{attrs:{label:"Sheet名称"}},[a("el-input",{model:{value:e.downdata.sheet,callback:function(t){e.$set(e.downdata,"sheet",t)},expression:"downdata.sheet"}})],1):e._e(),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.download}},[e._v("确认下载")])],1)],1)],1):e._e()],1)],1)],1)],1)],1)},staticRenderFns:[]};var f={name:"App",components:{Courses:a("VU/8")(p,d,!1,function(e){a("HB+n")},"data-v-7adf5c55",null).exports}},v={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("Courses")],1)},staticRenderFns:[]};var b=a("VU/8")(f,v,!1,function(e){a("Rp7v")},null,null).exports,g=a("zL8q"),m=a.n(g);a("tvR6");s.default.use(m.a),s.default.use(n.a),s.default.config.productionTip=!1;s.default.use(i.a,{uploaderFileUrl:"http://127.0.0.1:8080/courses/ie/uploadFile",deleteFileUrl:" http://127.0.0.1:8080/courses/ie/delFile",showMessage:function(e,t){e.$dlg.alert(t,{messageType:"error",language:"cn"})}}),new s.default({el:"#app",components:{App:b},template:"<App/>"})},Rp7v:function(e,t){},tvR6:function(e,t){}},["NHnr"]);